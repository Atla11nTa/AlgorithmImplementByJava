## 有序数据结构汇总

目录

>1. 二叉搜索树
>2. 平衡二叉树
>3. B树
>4. B+树
>5. 红黑树
>6. 跳表

---

### 二叉搜索树(BST)

结构特点: 左小右大, 左边节点元素均小于根节点, 而右边节点均大于根节点.

一些知识点: 中序遍历二叉搜索树可以得到一个升序序列.

---

### 平衡二叉树(AVL)

特点: 为了避免树的高度增长过快, 降低二叉排序树的查找性能, 所以限制左右子树的高度差不能小于2, 这样的二叉排序树就是平衡二叉树.

当更新操作导致平衡二叉树高度不平衡时, 会进行左旋或者右旋, 最终保持树的高度为O(logn), 以保证查找时间稳定在O(logn).

---

### 红黑树(RBT)

特点: 红黑树在二叉搜索树的基础上, 在每一节点上增加了一个存储位来表示节点的颜色, 可以是红色或者黑色, 通过对任何一棵从根到叶子的简单路径上各个节点的颜色进行约束, 红黑树可以确保没有一条路径会比其他路径长出两倍,因而是近似平衡的.

性质:

1) 每个节点要么是红色,要么是黑色

2) 根节点是黑色

3) 每个叶子节点是黑色

4) 每个红色节点的两个子节点一定是黑色

5) 任意一个结点到每个叶子节点的路径都包含数量相同的黑节点

通过上面这些约束条件, 会保证没有一条路径会比其他路径长出两倍, 所以红黑树实际平衡性是没有平衡二叉树高的.

在更新操作时, 当不满足约束条件时, 也会进行左旋右旋, 以保证满足约束. 

**问题1:**  红黑树与平衡二叉树的比较?

1. AVL 树比红黑树更加平衡，也就是说AVL树对平衡的要求更严格, AVL树在插入和删除的时候需要做更多的旋转操作。

2. 红黑树对高度的要求就没那么高, 很多时候可以通过变色来满足约束条件, 无需自旋, 所以自旋操作少, 性能更高.

对于更新操作频繁的场景, 还是红黑树更适用, 比如Java里的TreeMap和TreeSet都是红黑树结构. HashMap中, 当链表的长度超过阈值8时会转为红黑树.

---

### B树

特点: B树是一种多路平衡的排序二叉树, 每个节点最多包含k个孩子, k称为B树的阶, k的大小取决于磁盘页的大小. 相比于普通的排序二叉树, B树显得更加矮胖.

---

### B+树

特点: 与B树相比, B+树的非叶子节点不保存数据, 只用于索引, 所有数据都保存在叶子节点. 同时叶子节点之间通过双向链表连接, 构成一个有序的链表.

**问题1**: 为什么数据库索引使用B树而不使用平衡二叉树呢?

答: 因为一个大型数据库的索引大小是相当大的, 一次性将整个索引结构保存在内存中不现实, 所以不得不一次加载一部分. 那么对于上面查询结构, 一次查询就对应着一次IO, B树相对于平衡二叉树, 每个节点存放更多的元素, 所以树比较矮, IO操作就会少, 所以性能更高.

**问题2**: 为什么数据库索引常常使用B+树而不使用B树呢?

答:  1. 首先B+树只有叶子节点才保存元素信息, 所以B+树的查询最终都会找到叶子节点, 是稳定的, 而B树的查询不稳定.

2. 其次, B+树的非叶子节点不存放元素信息, 所以同样的磁盘页可以容纳更多的节点, 这样的话, 同样的元素数量, B+树的树高更矮, 查询IO次数更少.
3. B+树的叶子节点都使用双向链表连接, 所以更方便范围查询.

---

### 跳表

跳表也是一个有序结构, 结构类似与有序的矩阵, 从左到右递增, 从上到下也递增, 结构如下图: 

![1596112408690](/home/wan/.config/Typora/typora-user-images/1596112408690.png)

特点: 跳表通过这种多层结构加快了查询速度,  实现也比较简单.

**问题1**: 为什么Redis使用跳表而不用平衡树/哈希表?

答: 1. 首先跳表和平衡树都是有序结构, 而哈希表不是有序的, 哈希表适用于单个key的查找, 不适合范围查找.

2. 其次跳表比平衡树结构更简单, 更新操作简单, 代码实现也简单.
3. 平衡树在做范围查找时, 找到小值后还要再遍历找大值, 并不方便. 

**问题2**: 为什么Redis使用跳表而不用B+树?

答: 叶子节点存储数据，非叶子节点存储索引，B+树的每个节点可以存储多个关键字，它将节点大小设置为磁盘页的大小，充分利用了磁盘预读的功能。每次读取磁盘页时就会读取一整个节点,每个叶子节点还有指向前后节点的指针，为的是最大限度的降低磁盘的IO;因为数据在内存中读取耗费的时间是从磁盘的IO读取的百万分之一. 所以关系型数据库选择B+树是对IO效率的妥协.

而Redis是 内存中读取数据，不涉及IO，更新操作更简单, 为了更高的效率, 因此使用了跳表； 